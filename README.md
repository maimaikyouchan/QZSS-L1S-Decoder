# QZSS-L1S-Decoder
QZSS(みちびき)の災害危機通報をデコードするだけのPythonプログラム(未完成)です。  
Pythonを入れた環境が必要です。 
## 何ができるのか
### 防災気象情報(MT43)のデコード
気象庁防災情報XMLフォーマットに準じた内容を災害危機通報向けにコード化されたものが２５０ビットの１６進数に格納されて約４秒間隔で配信されています。    
#### is-qzss-dcr-013 (111p)Table 4.3.1-1 Sentence formatより
```
[Message header ($QZQSM)][Field delimiter(,)][Satellite ID(61)][Field delimiter(,)][DC Report Message(C6ADF～17AC4)][Field delimiter(*)][Checksum(0E)]{CRLF}
```
```
ヘッダー(６文字) 区切り(１文字) 衛星ID(みちびき３号機)(２文字) 災害危機通報内容(６３文字) 区切り(１文字) チェックサム(２文字) {改行コード}
```
    
このコードを一度全て２進数に置き換えた後 ```Disaster Category(DC)``` の値に応じて区切り位置を変えながら最終的に値を１０進数に置き換えて展開します。    
(一部は置き換えられた１０進数とソース内の辞書を照らし合わせて文字列に置き換えます。)    
     
### 任意情報(MT44)のデコード(※一部のみ)
各機関から配信されるJアラートやLアラートの情報を防災気象情報(MT43)と同じようにコード化されたものが約４秒間隔で配信されています。    
基本的な処理内容はあまり変わりませんが区切り位置が変則的だったり、ミサイルの着弾推定位置などで空間の座標計算などが含まれていたりとかなり難解です。    
なお、Jアラートのミサイル発射情報だけはデコードできるはずですが、それ以外の情報処理は未完成です。
    
これらの基本的な情報や仕様などは全て、みちびきの公式ホームページ( https://qzss.go.jp ) に掲載されています。    

## 使い方
ミートスパゲッティ.pyをダブルクリックするか、コマンドラインで呼び出すと```Data:```と出るのでSpresenseなどで取得した   
```$QZQSM,??,~~~~~~~~~~~*??``` をそのまま入力するか ```~~~~~~~~~```内の16進数(災害危機通報)のみを入力すると動作するはずです。   
(末尾の```*??```(チェックサム)は検証していません。)   
### 入力例
```
$QZQSM,57,C6AF8B2C8000DB24000059000548C5E2C000000003DFF8001C000012BA056F0*08
```
または    
```
C6AF8B2C8000DB24000059000548C5E2C000000003DFF8001C000012BA056F0
```
と入力します。    

    
いろいろ見たい場合はソース内上部(約5行目)にある```debugmode```の値を```True```にすると表示できます。   
一部は```debugmode```に関わらずごちゃごちゃと出力されます。(改修漏れ)   
動かない時はご自身で修正してください。(ほとんどの場合、私の理解が不十分だった事によるものです)   
今後新たな災害危機通報の内容が追加変更された時に使えるよう、Excelシートで作ったテンプレート作成ツールを入れておきます。   
マクロとかの高度機能は使用しておらず、セルの内容をくっつけているだけなのでLibreOfficeでも使えるはずです試してみてください。   

## 各種資料から引用した試験用メッセージ
以下は動作確認で使用していたメッセージデータの例です。
#### 緊急地震速報(胆振東部地震)
```
9AAC89558B0003240000AB160F3A2499B40000000000002000000010C93712C
```
#### 緊急地震速報(能登地震)
```
53AC8A95CB00032400002B96054661A6C00207A000000000000000100000000
```
#### 火山情報(詳細不明)
```
53AD408400000040001065035B600756200EAF601D65003AD68000100000000
```
#### 津波関連(若干の海面変動あり)
```
C6AD108400000000CA670800000002C8C0010E0000000000000000100000000
```

## 実際にSpresenseで受信したメッセージ(一部省略)
#### 実際に受信した海上気象情報(日本海沿岸)
```
53ADF321140002D00E5A044B4E2169FB2D4005A814B5DEA81FE00012273BC4C
```
#### 実際に受信した海上気象情報(北海道沿岸)
```
C6ADF321140002C3E858898B1F6963F22CC2659860B30E9662200011F1CF5E8
```
#### 実際に受信したMT44の情報(詳細不明)
```
9AB0600DE00000000000000000000000000000000000000000000000D621F6C
```
#### 実際に受信した海上気象情報(四国沿岸で3つ空白)
```
C6ADF31DD400050FAA00000000000000000000000000000000000013F7C4864 
```

### 実際にSpresenseで受信したメッセージ2024.06.11 13:00からの試験(一例)

#### 緊急地震速報
```
$QZQSM,57,C6AF8B2C8000DB24000059000548C5E2C000000003DFF8001C000012BA056F0*08
```
#### 震源情報
```
$QZQSM,57,9AAF932C82800388000059051440C5C82A010830000000000000001125784D0*77
```
#### 震度情報
```
$QZQSM,57,9AAF9B2C828002C82CB25AE775A8D4CA854AB8000000000000000013580AEDC*78
```
#### 南海トラフ地震
```
$QZQSM,57,9AAFA32C918002F2D141F3CAC671C0D3F4C04D72DC5C71C0D406D8132C8E77C*0B
```
#### 津波情報
```
$QZQSM,57,9AAFAB2C828001E8F67C31053960414E621053BE00000000000000139201B28*0A
```


### シリアルで実際に得られるデータ
```
$QZQSM,61,C6ADF31DD40002D0185A710B4FB16BBD503FCA08214106A861300010B517AC4*0E {CRLF}
```

## 最後に・・・・
このくだらないソースの一部を使って「俺が作った！やったぜ！」とかされちゃうと約2.5年間保っていたモチベがめっちゃ下がります。   
何も要りませんし金銭とかを要求するつもりは全くありませんが、もし一言感想とかを頂ければまた何かこういうのを作ろうとした時にモチベが保てます。

#### 余談：何で「ミートスパゲッティ.py」という名前にしたのか
作っている段階からスパゲッティコードだったので「スパゲッティ.py」という名前にしようとしたけど、これを載せると決めた時にちょうどお腹が空いててミートボールのトッピングが欲しかったので、ミート(ボール)＋スパゲッティになった。(要は深い意味はない)    
